{% include "html/header.html" %}
	<script src="https://cdn.jsdelivr.net/npm/d3@7.0.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega@5.20.2"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega-lite@5.1.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega-embed@6.18.2"></script>
	<script src="https://cdn.jsdelivr.net/npm/datalib@1.9.3"></script>
	<link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.25.0/min/vs/editor/editor.main.css">
<script>
function setDashboard(myhtml) {
	document.getElementById('dashboard').innerHTML = myhtml;
}
async function bindView(vid, xvid, config={}) {
	var spec = JSON.parse(await (await fetch('/view?xid='+xvid)).json());
	var baseConfig = {actions:false, theme:'dark'};
	var embedConfig = {...baseConfig, ...config};
	await vegaEmbed('#'+vid, spec, embedConfig);
}
</script>
<script>
	var require = {"paths":{"vs":"https://cdn.jsdelivr.net/npm/monaco-editor@0.25.0/min/vs/"}};
</script>
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.25.0/min/vs/loader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.25.0/min/vs/editor/editor.main.nls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.25.0/min/vs/editor/editor.main.js"></script>
<style>
#main {
	display: flex;
}
#editor {
	flex: 0 0 500px;
}
#dashboard {
	flex: 1 1 auto;
}
</style>
</head>
<body>
<h2>Distillery Dashboard</h2>
<div id="main">

	<div id="editor" style="width: 1800px; height: 800px; border: 1px solid grey" 
	onclick="
		var spec = window.editor.getValue();
		document.getElementById('configuration').value = spec;
		let specFunc = new Function('(async function(){'+spec+'})();');
		specFunc();
	"
	 autofocus>
	</div>

	<div id="dashboard"></div>
</div>

<script>
	window.editor = monaco.editor.create(document.getElementById('editor'), {
		value: '',
		language: 'javascript',
		scrollbar: {
			vertical: 'auto',
			horizontal: 'auto'
		},
		theme: 'vs-dark',
		automaticLayout: true,
	});
</script>

<form name="new" action="dashboard" method="post">
<ul>
	<li class="formrow">
		<label for="name">name:</label>
		<input id="name" type="text" name="name" value="" required/>
	</li>
	<input type="hidden" id="configuration" name="configuration" value="">
</ul>
<br/>
<input type="submit" value="+">
</form>


{% for dashboard in dashboards: %}
	{{ dashboard }} <br/>
{% endfor %}



</body>
</html>
