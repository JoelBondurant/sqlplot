{% include "header.html" %}
</head>
<body>
<script>
async function deriveKey(akey) {
	akey = await crypto.subtle.importKey(
		'raw',
		(new TextEncoder()).encode(akey),
		{
			'name': 'PBKDF2',
		},
		false,
		['deriveBits', 'deriveKey']
	);
	return await crypto.subtle.deriveKey(
	{
		'name': 'PBKDF2',
		'salt': Uint8Array.from([79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94]),
		'iterations': 7979,
		'hash': 'SHA-512',
	},
	akey,
	{
		'name': 'AES-GCM',
		'length': 256,
	},
	true,
	['encrypt', 'decrypt']);
}
</script>
<script>
async function signUp() {
	var passwordField = document.getElementById('password');
	var password = passwordField.value;
	var derivedKey = await deriveKey(password);
	var derivedPassword = (await crypto.subtle.exportKey('jwk', derivedKey))['k'];
	passwordField.value = derivedPassword;
	var name = document.getElementById('name').value;
	var formData = {'name': name, 'password': derivedPassword};
	await fetch('/signup', {'method': 'POST', 'body': JSON.stringify(formData)});
	window.location.assign('/login');
}
</script>

<form name="signup" action="signup" method="post">
<ul>
	<li class="formrow">
		<label for="name">name:</label>
		<input id="name" type="text" name="name" value=""
			minlength=4 maxlength=32 required/>
	</li>
	<li class="formrow">
		<label for="password">password:</label>
		<input id="password" type="password" name="password" value=""
			minlength=8 maxlength=64 required/>
	</li>
</ul>
<br/>
<input type="button" value="signup" onclick="signUp();">
</form>

</body>
</html>
